{% with widget.value.sub_ramo as sub_ramo %}


    <input type="hidden" id="id_{{ widget.name }}" name="{{ widget.name }}"
           value="{{ widget.value.extra_data }}">

    <div class="container {{ widget.name }}_fieldset">
        {% for field in sub_ramo.campos_adicionales %}

            <div class="col">
                <div id="div_{{ field.name }}" class="form-group">

                    <label for="id_{{ field.name }}" class="col-form-label">
                        {{ field.label }}
                    </label>

                    <input name="{{ field.name }}" class="form-control" id="id_{{ field.name }}">

                </div>
            </div>

        {% endfor %}
    </div>

{% endwith %}

<script type="text/javascript">

    (function ($) {
        $(document).ready(function () {

            const $fieldset = $('.{{ widget.name }}_fieldset');

            const $input = $('#id_{{ widget.name }}');

            const load_data = function () {
                let data = JSON.parse($($input).val());
                Object.keys(data).forEach(function (k) {
                    $($fieldset).find('#id_' + k).val(data[k]);
                });
            };

            {% if widget.value.extra_data %}

                load_data();

            {% endif %}

            $($fieldset).on('change', 'input', function () {
                obj = {};
                $.each($($fieldset).find('input'), function (i, o) {
                    obj[$(o).attr('name')] = $(o).val()
                });
                $($input).val(JSON.stringify(obj));
            });
        })
    })(jQuery)

</script>
